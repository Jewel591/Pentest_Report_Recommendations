## Unrestricted File Upload

### Vulnerability Description

Uploaded files represent a significant risk to applications. The first step in many attacks is to get some code to the system to be attacked. Then the attack only needs to find a way to get the code executed. Using a file upload helps the attacker accomplish the first step.
The vulnerability is typically caused by poor filtering of files uploaded by the file upload feature in the code. If the file upload feature code does not strictly restrict and validate the file extensions, types, etc. uploaded by the user, an attacker could take control of an entire website by uploading any file, including a website backdoor file (webshell), through the file upload point.

### Vulnerability Impact

The consequences of unrestricted file upload can vary, including complete system takeover, an overloaded file system or database, forwarding attacks to back-end systems, client-side attacks, or simple defacement. It depends on what the application does with the uploaded file and especially where it is stored.

### Repair Recommendation

the following principles should be followed to reach a secure file upload implementation:

- Whitelist allowed extensions. Only allow safe and critical extensions for business functionality
- Validate the file type, don't trust the Content-Type header as it can be spoofed
- Change the filename to something generated by the application
- Set a filename length limit. Restrict the allowed characters if possible
- Set a file size limit
- Only allow authorised users to upload files
- Store the files on a different server. If that's not possible, store them outside of the webroot
- In the case of public access to the files, use a handler that gets mapped to filenames inside the application (someid -> file.ext)
- Run the file through an antivirus or a sandbox if available to validate that it doesn't contain malicious data
- Protect the file upload from CSRF attacks

For more detailed restoration recommendations, please see:
```
https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html
```
